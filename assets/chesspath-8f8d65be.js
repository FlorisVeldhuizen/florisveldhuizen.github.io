import"./modulepreload-polyfill-3cfb730f.js";import{c as _e,g as Ee}from"./_commonjsHelpers-042e6b4d.js";import{$ as ae}from"./jquery-1e3ca89c.js";var pe={exports:{}};pe.exports;(function(e){(function(){var t,i,r,n,a,s,h,u,f,p,v,m,b,F,c;r=Math.floor,p=Math.min,i=function(l,o){return l<o?-1:l>o?1:0},f=function(l,o,d,M,W){var w;if(d==null&&(d=0),W==null&&(W=i),d<0)throw new Error("lo must be non-negative");for(M==null&&(M=l.length);d<M;)w=r((d+M)/2),W(o,l[w])<0?M=w:d=w+1;return[].splice.apply(l,[d,d-d].concat(o)),o},s=function(l,o,d){return d==null&&(d=i),l.push(o),F(l,0,l.length-1,d)},a=function(l,o){var d,M;return o==null&&(o=i),d=l.pop(),l.length?(M=l[0],l[0]=d,c(l,0,o)):M=d,M},u=function(l,o,d){var M;return d==null&&(d=i),M=l[0],l[0]=o,c(l,0,d),M},h=function(l,o,d){var M;return d==null&&(d=i),l.length&&d(l[0],o)<0&&(M=[l[0],o],o=M[0],l[0]=M[1],c(l,0,d)),o},n=function(l,o){var d,M,W,w,N,g;for(o==null&&(o=i),w=(function(){g=[];for(var A=0,k=r(l.length/2);0<=k?A<k:A>k;0<=k?A++:A--)g.push(A);return g}).apply(this).reverse(),N=[],M=0,W=w.length;M<W;M++)d=w[M],N.push(c(l,d,o));return N},b=function(l,o,d){var M;if(d==null&&(d=i),M=l.indexOf(o),M!==-1)return F(l,0,M,d),c(l,M,d)},v=function(l,o,d){var M,W,w,N,g;if(d==null&&(d=i),W=l.slice(0,o),!W.length)return W;for(n(W,d),g=l.slice(o),w=0,N=g.length;w<N;w++)M=g[w],h(W,M,d);return W.sort(d).reverse()},m=function(l,o,d){var M,W,w,N,g,A,k,P,D;if(d==null&&(d=i),o*10<=l.length){if(w=l.slice(0,o).sort(d),!w.length)return w;for(W=w[w.length-1],k=l.slice(o),N=0,A=k.length;N<A;N++)M=k[N],d(M,W)<0&&(f(w,M,0,null,d),w.pop(),W=w[w.length-1]);return w}for(n(l,d),D=[],g=0,P=p(o,l.length);0<=P?g<P:g>P;0<=P?++g:--g)D.push(a(l,d));return D},F=function(l,o,d,M){var W,w,N;for(M==null&&(M=i),W=l[d];d>o;){if(N=d-1>>1,w=l[N],M(W,w)<0){l[d]=w,d=N;continue}break}return l[d]=W},c=function(l,o,d){var M,W,w,N,g;for(d==null&&(d=i),W=l.length,g=o,w=l[o],M=2*o+1;M<W;)N=M+1,N<W&&!(d(l[M],l[N])<0)&&(M=N),l[o]=l[M],o=M,M=2*o+1;return l[o]=w,F(l,g,o,d)},t=function(){l.push=s,l.pop=a,l.replace=u,l.pushpop=h,l.heapify=n,l.updateItem=b,l.nlargest=v,l.nsmallest=m;function l(o){this.cmp=o??i,this.nodes=[]}return l.prototype.push=function(o){return s(this.nodes,o,this.cmp)},l.prototype.pop=function(){return a(this.nodes,this.cmp)},l.prototype.peek=function(){return this.nodes[0]},l.prototype.contains=function(o){return this.nodes.indexOf(o)!==-1},l.prototype.replace=function(o){return u(this.nodes,o,this.cmp)},l.prototype.pushpop=function(o){return h(this.nodes,o,this.cmp)},l.prototype.heapify=function(){return n(this.nodes,this.cmp)},l.prototype.updateItem=function(o){return b(this.nodes,o,this.cmp)},l.prototype.clear=function(){return this.nodes=[]},l.prototype.empty=function(){return this.nodes.length===0},l.prototype.size=function(){return this.nodes.length},l.prototype.clone=function(){var o;return o=new l,o.nodes=this.nodes.slice(0),o},l.prototype.toArray=function(){return this.nodes.slice(0)},l.prototype.insert=l.prototype.push,l.prototype.top=l.prototype.peek,l.prototype.front=l.prototype.peek,l.prototype.has=l.prototype.contains,l.prototype.copy=l.prototype.clone,l}(),e!==null&&e.exports?e.exports=t:window.Heap=t}).call(_e)})(pe);var Ge=pe.exports,ne=Ge;function Qe(e,t,i){this.x=e,this.y=t,this.walkable=i===void 0?!0:i}var ge=Qe,ze={Always:1,Never:2,IfAtMostOneObstacle:3,OnlyWhenNoObstacles:4},R=ze,Oe=ge,Y=R;function T(e,t,i){var r;typeof e!="object"?r=e:(t=e.length,r=e[0].length,i=e),this.width=r,this.height=t,this.nodes=this._buildNodes(r,t,i)}T.prototype._buildNodes=function(e,t,i){var r,n,a=new Array(t);for(r=0;r<t;++r)for(a[r]=new Array(e),n=0;n<e;++n)a[r][n]=new Oe(n,r);if(i===void 0)return a;if(i.length!==t||i[0].length!==e)throw new Error("Matrix size does not fit");for(r=0;r<t;++r)for(n=0;n<e;++n)i[r][n]&&(a[r][n].walkable=!1);return a};T.prototype.getNodeAt=function(e,t){return this.nodes[t][e]};T.prototype.isWalkableAt=function(e,t){return this.isInside(e,t)&&this.nodes[t][e].walkable};T.prototype.isInside=function(e,t){return e>=0&&e<this.width&&t>=0&&t<this.height};T.prototype.setWalkableAt=function(e,t,i){this.nodes[t][e].walkable=i};T.prototype.getNeighbors=function(e,t){var i=e.x,r=e.y,n=[],a=!1,s=!1,h=!1,u=!1,f=!1,p=!1,v=!1,m=!1,b=this.nodes;if(this.isWalkableAt(i,r-1)&&(n.push(b[r-1][i]),a=!0),this.isWalkableAt(i+1,r)&&(n.push(b[r][i+1]),h=!0),this.isWalkableAt(i,r+1)&&(n.push(b[r+1][i]),f=!0),this.isWalkableAt(i-1,r)&&(n.push(b[r][i-1]),v=!0),t===Y.Never)return n;if(t===Y.OnlyWhenNoObstacles)s=v&&a,u=a&&h,p=h&&f,m=f&&v;else if(t===Y.IfAtMostOneObstacle)s=v||a,u=a||h,p=h||f,m=f||v;else if(t===Y.Always)s=!0,u=!0,p=!0,m=!0;else throw new Error("Incorrect value of diagonalMovement");return s&&this.isWalkableAt(i-1,r-1)&&n.push(b[r-1][i-1]),u&&this.isWalkableAt(i+1,r-1)&&n.push(b[r-1][i+1]),p&&this.isWalkableAt(i+1,r+1)&&n.push(b[r+1][i+1]),m&&this.isWalkableAt(i-1,r+1)&&n.push(b[r+1][i-1]),n};T.prototype.clone=function(){var e,t,i=this.width,r=this.height,n=this.nodes,a=new T(i,r),s=new Array(r);for(e=0;e<r;++e)for(s[e]=new Array(i),t=0;t<i;++t)s[e][t]=new Oe(t,e,n[e][t].walkable);return a.nodes=s,a};var Xe=T,J={};function ce(e){for(var t=[[e.x,e.y]];e.parent;)e=e.parent,t.push([e.x,e.y]);return t.reverse()}J.backtrace=ce;function Ye(e,t){var i=ce(e),r=ce(t);return i.concat(r.reverse())}J.biBacktrace=Ye;function $e(e){var t,i=0,r,n,a,s;for(t=1;t<e.length;++t)r=e[t-1],n=e[t],a=r[0]-n[0],s=r[1]-n[1],i+=Math.sqrt(a*a+s*s);return i}J.pathLength=$e;function ve(e,t,i,r){var n=Math.abs,a=[],s,h,u,f,p,v;for(u=n(i-e),f=n(r-t),s=e<i?1:-1,h=t<r?1:-1,p=u-f;a.push([e,t]),!(e===i&&t===r);)v=2*p,v>-f&&(p=p-f,e=e+s),v<u&&(p=p+u,t=t+h);return a}J.interpolate=ve;function Ze(e){var t=[],i=e.length,r,n,a,s,h,u;if(i<2)return t;for(h=0;h<i-1;++h)for(r=e[h],n=e[h+1],a=ve(r[0],r[1],n[0],n[1]),s=a.length,u=0;u<s-1;++u)t.push(a[u]);return t.push(e[i-1]),t}J.expandPath=Ze;function Ke(e,t){var i=t.length,r=t[0][0],n=t[0][1],a=t[i-1][0],s=t[i-1][1],h,u,f,p,v,m,b,F,c,l,o;for(h=r,u=n,v=[[h,u]],m=2;m<i;++m){for(F=t[m],f=F[0],p=F[1],c=ve(h,u,f,p),o=!1,b=1;b<c.length;++b)if(l=c[b],!e.isWalkableAt(l[0],l[1])){o=!0;break}o&&(lastValidCoord=t[m-1],v.push(lastValidCoord),h=lastValidCoord[0],u=lastValidCoord[1])}return v.push([a,s]),v}J.smoothenPath=Ke;function xe(e){if(e.length<3)return e;var t=[],i=e[0][0],r=e[0][1],n=e[1][0],a=e[1][1],s=n-i,h=a-r,u,f,p,v,m,b;for(m=Math.sqrt(s*s+h*h),s/=m,h/=m,t.push([i,r]),b=2;b<e.length;b++)u=n,f=a,p=s,v=h,n=e[b][0],a=e[b][1],s=n-u,h=a-f,m=Math.sqrt(s*s+h*h),s/=m,h/=m,(s!==p||h!==v)&&t.push([u,f]);return t.push([n,a]),t}J.compressPath=xe;var z={manhattan:function(e,t){return e+t},euclidean:function(e,t){return Math.sqrt(e*e+t*t)},octile:function(e,t){var i=Math.SQRT2-1;return e<t?i*e+t:i*t+e},chebyshev:function(e,t){return Math.max(e,t)}},et=ne,tt=J,oe=z,$=R;function De(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.heuristic=e.heuristic||oe.manhattan,this.weight=e.weight||1,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=$.OnlyWhenNoObstacles:this.diagonalMovement=$.IfAtMostOneObstacle:this.diagonalMovement=$.Never),this.diagonalMovement===$.Never?this.heuristic=e.heuristic||oe.manhattan:this.heuristic=e.heuristic||oe.octile}De.prototype.findPath=function(e,t,i,r,n){var a=new et(function(w,N){return w.f-N.f}),s=n.getNodeAt(e,t),h=n.getNodeAt(i,r),u=this.heuristic,f=this.diagonalMovement,p=this.weight,v=Math.abs,m=Math.SQRT2,b,F,c,l,o,d,M,W;for(s.g=0,s.f=0,a.push(s),s.opened=!0;!a.empty();){if(b=a.pop(),b.closed=!0,b===h)return tt.backtrace(h);for(F=n.getNeighbors(b,f),l=0,o=F.length;l<o;++l)c=F[l],!c.closed&&(d=c.x,M=c.y,W=b.g+(d-b.x===0||M-b.y===0?1:m),(!c.opened||W<c.g)&&(c.g=W,c.h=c.h||p*u(v(d-i),v(M-r)),c.f=c.g+c.h,c.parent=b,c.opened?a.updateItem(c):(a.push(c),c.opened=!0)))}return[]};var be=De,Ce=be;function x(e){Ce.call(this,e);var t=this.heuristic;this.heuristic=function(i,r){return t(i,r)*1e6}}x.prototype=new Ce;x.prototype.constructor=x;var it=x,nt=J,le=R;function Be(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=le.OnlyWhenNoObstacles:this.diagonalMovement=le.IfAtMostOneObstacle:this.diagonalMovement=le.Never)}Be.prototype.findPath=function(e,t,i,r,n){var a=[],s=this.diagonalMovement,h=n.getNodeAt(e,t),u=n.getNodeAt(i,r),f,p,v,m,b;for(a.push(h),h.opened=!0;a.length;){if(v=a.shift(),v.closed=!0,v===u)return nt.backtrace(u);for(f=n.getNeighbors(v,s),m=0,b=f.length;m<b;++m)p=f[m],!(p.closed||p.opened)&&(a.push(p),p.opened=!0,p.parent=v)}return[]};var rt=Be,Ie=be;function ee(e){Ie.call(this,e),this.heuristic=function(t,i){return 0}}ee.prototype=new Ie;ee.prototype.constructor=ee;var st=ee,Me=ne,ke=J,he=z,Z=R;function Se(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||he.manhattan,this.weight=e.weight||1,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=Z.OnlyWhenNoObstacles:this.diagonalMovement=Z.IfAtMostOneObstacle:this.diagonalMovement=Z.Never),this.diagonalMovement===Z.Never?this.heuristic=e.heuristic||he.manhattan:this.heuristic=e.heuristic||he.octile}Se.prototype.findPath=function(e,t,i,r,n){var a=function(k,P){return k.f-P.f},s=new Me(a),h=new Me(a),u=n.getNodeAt(e,t),f=n.getNodeAt(i,r),p=this.heuristic,v=this.diagonalMovement,m=this.weight,b=Math.abs,F=Math.SQRT2,c,l,o,d,M,W,w,N,g=1,A=2;for(u.g=0,u.f=0,s.push(u),u.opened=g,f.g=0,f.f=0,h.push(f),f.opened=A;!s.empty()&&!h.empty();){for(c=s.pop(),c.closed=!0,l=n.getNeighbors(c,v),d=0,M=l.length;d<M;++d)if(o=l[d],!o.closed){if(o.opened===A)return ke.biBacktrace(c,o);W=o.x,w=o.y,N=c.g+(W-c.x===0||w-c.y===0?1:F),(!o.opened||N<o.g)&&(o.g=N,o.h=o.h||m*p(b(W-i),b(w-r)),o.f=o.g+o.h,o.parent=c,o.opened?s.updateItem(o):(s.push(o),o.opened=g))}for(c=h.pop(),c.closed=!0,l=n.getNeighbors(c,v),d=0,M=l.length;d<M;++d)if(o=l[d],!o.closed){if(o.opened===g)return ke.biBacktrace(o,c);W=o.x,w=o.y,N=c.g+(W-c.x===0||w-c.y===0?1:F),(!o.opened||N<o.g)&&(o.g=N,o.h=o.h||m*p(b(W-e),b(w-t)),o.f=o.g+o.h,o.parent=c,o.opened?h.updateItem(o):(h.push(o),o.opened=A))}}return[]};var Ae=Se,je=Ae;function te(e){je.call(this,e);var t=this.heuristic;this.heuristic=function(i,r){return t(i,r)*1e6}}te.prototype=new je;te.prototype.constructor=te;var at=te,we=J,ue=R;function Je(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=ue.OnlyWhenNoObstacles:this.diagonalMovement=ue.IfAtMostOneObstacle:this.diagonalMovement=ue.Never)}Je.prototype.findPath=function(e,t,i,r,n){var a=n.getNodeAt(e,t),s=n.getNodeAt(i,r),h=[],u=[],f,p,v,m=this.diagonalMovement,b=0,F=1,c,l;for(h.push(a),a.opened=!0,a.by=b,u.push(s),s.opened=!0,s.by=F;h.length&&u.length;){for(v=h.shift(),v.closed=!0,f=n.getNeighbors(v,m),c=0,l=f.length;c<l;++c)if(p=f[c],!p.closed){if(p.opened){if(p.by===F)return we.biBacktrace(v,p);continue}h.push(p),p.parent=v,p.opened=!0,p.by=b}for(v=u.shift(),v.closed=!0,f=n.getNeighbors(v,m),c=0,l=f.length;c<l;++c)if(p=f[c],!p.closed){if(p.opened){if(p.by===b)return we.biBacktrace(p,v);continue}u.push(p),p.parent=v,p.opened=!0,p.by=F}}return[]};var ot=Je,Re=Ae;function ie(e){Re.call(this,e),this.heuristic=function(t,i){return 0}}ie.prototype=new Re;ie.prototype.constructor=ie;var lt=ie,fe=z,Ne=ge,K=R;function qe(e){e=e||{},this.allowDiagonal=e.allowDiagonal,this.dontCrossCorners=e.dontCrossCorners,this.diagonalMovement=e.diagonalMovement,this.heuristic=e.heuristic||fe.manhattan,this.weight=e.weight||1,this.trackRecursion=e.trackRecursion||!1,this.timeLimit=e.timeLimit||1/0,this.diagonalMovement||(this.allowDiagonal?this.dontCrossCorners?this.diagonalMovement=K.OnlyWhenNoObstacles:this.diagonalMovement=K.IfAtMostOneObstacle:this.diagonalMovement=K.Never),this.diagonalMovement===K.Never?this.heuristic=e.heuristic||fe.manhattan:this.heuristic=e.heuristic||fe.octile}qe.prototype.findPath=function(e,t,i,r,n){var a=new Date().getTime(),s=(function(c,l){return this.heuristic(Math.abs(l.x-c.x),Math.abs(l.y-c.y))}).bind(this),h=function(c,l){return c.x===l.x||c.y===l.y?1:Math.SQRT2},u=(function(c,l,o,d,M){if(this.timeLimit>0&&new Date().getTime()-a>this.timeLimit*1e3)return 1/0;var W=l+s(c,p)*this.weight;if(W>o)return W;if(c==p)return d[M]=[c.x,c.y],c;var w,N,g,A,k=n.getNeighbors(c,this.diagonalMovement);for(g=0,w=1/0;A=k[g];++g){if(this.trackRecursion&&(A.retainCount=A.retainCount+1||1,A.tested!==!0&&(A.tested=!0)),N=u(A,l+h(c,A),o,d,M+1),N instanceof Ne)return d[M]=[c.x,c.y],N;this.trackRecursion&&--A.retainCount===0&&(A.tested=!1),N<w&&(w=N)}return w}).bind(this),f=n.getNodeAt(e,t),p=n.getNodeAt(i,r),v=s(f,p),m,b,F;for(m=0;;++m){if(b=[],F=u(f,0,v,b,0),F===1/0)return[];if(F instanceof Ne)return b;v=F}return[]};var ht=qe,ut=ne,We=J,Te=z;function me(e){e=e||{},this.heuristic=e.heuristic||Te.manhattan,this.trackJumpRecursion=e.trackJumpRecursion||!1}me.prototype.findPath=function(e,t,i,r,n){var a=this.openList=new ut(function(f,p){return f.f-p.f}),s=this.startNode=n.getNodeAt(e,t),h=this.endNode=n.getNodeAt(i,r),u;for(this.grid=n,s.g=0,s.f=0,a.push(s),s.opened=!0;!a.empty();){if(u=a.pop(),u.closed=!0,u===h)return We.expandPath(We.backtrace(h));this._identifySuccessors(u)}return[]};me.prototype._identifySuccessors=function(e){var t=this.grid,i=this.heuristic,r=this.openList,n=this.endNode.x,a=this.endNode.y,s,h,u,f,p,v=e.x,m=e.y,b,F,c,l,o,d=Math.abs;for(s=this._findNeighbors(e),f=0,p=s.length;f<p;++f)if(h=s[f],u=this._jump(h[0],h[1],v,m),u){if(b=u[0],F=u[1],o=t.getNodeAt(b,F),o.closed)continue;c=Te.octile(d(b-v),d(F-m)),l=e.g+c,(!o.opened||l<o.g)&&(o.g=l,o.h=o.h||i(d(b-n),d(F-a)),o.f=o.g+o.h,o.parent=e,o.opened?r.updateItem(o):(r.push(o),o.opened=!0))}};var re=me,Le=re,ft=R;function V(e){Le.call(this,e)}V.prototype=new Le;V.prototype.constructor=V;V.prototype._jump=function(e,t,i,r){var n=this.grid,a=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-a,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-a,t+1))return[e,t]}else if(s!==0){if(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-s)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-s))return[e,t];if(this._jump(e+1,t,e,t)||this._jump(e-1,t,e,t))return[e,t]}else throw new Error("Only horizontal and vertical movements are allowed");return this._jump(e+a,t+s,e,t)};V.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,a,s,h,u,f=[],p,v,m,b;if(t)a=t.x,s=t.y,h=(i-a)/Math.max(Math.abs(i-a),1),u=(r-s)/Math.max(Math.abs(r-s),1),h!==0?(n.isWalkableAt(i,r-1)&&f.push([i,r-1]),n.isWalkableAt(i,r+1)&&f.push([i,r+1]),n.isWalkableAt(i+h,r)&&f.push([i+h,r])):u!==0&&(n.isWalkableAt(i-1,r)&&f.push([i-1,r]),n.isWalkableAt(i+1,r)&&f.push([i+1,r]),n.isWalkableAt(i,r+u)&&f.push([i,r+u]));else for(p=n.getNeighbors(e,ft.Never),m=0,b=p.length;m<b;++m)v=p[m],f.push([v.x,v.y]);return f};var dt=V,He=re,ct=R;function U(e){He.call(this,e)}U.prototype=new He;U.prototype.constructor=U;U.prototype._jump=function(e,t,i,r){var n=this.grid,a=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0&&s!==0){if(n.isWalkableAt(e-a,t+s)&&!n.isWalkableAt(e-a,t)||n.isWalkableAt(e+a,t-s)&&!n.isWalkableAt(e,t-s))return[e,t];if(this._jump(e+a,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(a!==0){if(n.isWalkableAt(e+a,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+a,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+s)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+s)&&!n.isWalkableAt(e-1,t))return[e,t];return this._jump(e+a,t+s,e,t)};U.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,a,s,h,u,f=[],p,v,m,b;if(t)a=t.x,s=t.y,h=(i-a)/Math.max(Math.abs(i-a),1),u=(r-s)/Math.max(Math.abs(r-s),1),h!==0&&u!==0?(n.isWalkableAt(i,r+u)&&f.push([i,r+u]),n.isWalkableAt(i+h,r)&&f.push([i+h,r]),n.isWalkableAt(i+h,r+u)&&f.push([i+h,r+u]),n.isWalkableAt(i-h,r)||f.push([i-h,r+u]),n.isWalkableAt(i,r-u)||f.push([i+h,r-u])):h===0?(n.isWalkableAt(i,r+u)&&f.push([i,r+u]),n.isWalkableAt(i+1,r)||f.push([i+1,r+u]),n.isWalkableAt(i-1,r)||f.push([i-1,r+u])):(n.isWalkableAt(i+h,r)&&f.push([i+h,r]),n.isWalkableAt(i,r+1)||f.push([i+h,r+1]),n.isWalkableAt(i,r-1)||f.push([i+h,r-1]));else for(p=n.getNeighbors(e,ct.Always),m=0,b=p.length;m<b;++m)v=p[m],f.push([v.x,v.y]);return f};var pt=U,Ve=re,gt=R;function _(e){Ve.call(this,e)}_.prototype=new Ve;_.prototype.constructor=_;_.prototype._jump=function(e,t,i,r){var n=this.grid,a=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0&&s!==0){if(this._jump(e+a,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(a!==0){if(n.isWalkableAt(e,t-1)&&!n.isWalkableAt(e-a,t-1)||n.isWalkableAt(e,t+1)&&!n.isWalkableAt(e-a,t+1))return[e,t]}else if(s!==0&&(n.isWalkableAt(e-1,t)&&!n.isWalkableAt(e-1,t-s)||n.isWalkableAt(e+1,t)&&!n.isWalkableAt(e+1,t-s)))return[e,t];return n.isWalkableAt(e+a,t)&&n.isWalkableAt(e,t+s)?this._jump(e+a,t+s,e,t):null};_.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,a,s,h,u,f=[],p,v,m,b;if(t)if(a=t.x,s=t.y,h=(i-a)/Math.max(Math.abs(i-a),1),u=(r-s)/Math.max(Math.abs(r-s),1),h!==0&&u!==0)n.isWalkableAt(i,r+u)&&f.push([i,r+u]),n.isWalkableAt(i+h,r)&&f.push([i+h,r]),n.isWalkableAt(i,r+u)&&n.isWalkableAt(i+h,r)&&f.push([i+h,r+u]);else{var F;if(h!==0){F=n.isWalkableAt(i+h,r);var c=n.isWalkableAt(i,r+1),l=n.isWalkableAt(i,r-1);F&&(f.push([i+h,r]),c&&f.push([i+h,r+1]),l&&f.push([i+h,r-1])),c&&f.push([i,r+1]),l&&f.push([i,r-1])}else if(u!==0){F=n.isWalkableAt(i,r+u);var o=n.isWalkableAt(i+1,r),d=n.isWalkableAt(i-1,r);F&&(f.push([i,r+u]),o&&f.push([i+1,r+u]),d&&f.push([i-1,r+u])),o&&f.push([i+1,r]),d&&f.push([i-1,r])}}else for(p=n.getNeighbors(e,gt.OnlyWhenNoObstacles),m=0,b=p.length;m<b;++m)v=p[m],f.push([v.x,v.y]);return f};var vt=_,Ue=re,bt=R;function E(e){Ue.call(this,e)}E.prototype=new Ue;E.prototype.constructor=E;E.prototype._jump=function(e,t,i,r){var n=this.grid,a=e-i,s=t-r;if(!n.isWalkableAt(e,t))return null;if(this.trackJumpRecursion===!0&&(n.getNodeAt(e,t).tested=!0),n.getNodeAt(e,t)===this.endNode)return[e,t];if(a!==0&&s!==0){if(n.isWalkableAt(e-a,t+s)&&!n.isWalkableAt(e-a,t)||n.isWalkableAt(e+a,t-s)&&!n.isWalkableAt(e,t-s))return[e,t];if(this._jump(e+a,t,e,t)||this._jump(e,t+s,e,t))return[e,t]}else if(a!==0){if(n.isWalkableAt(e+a,t+1)&&!n.isWalkableAt(e,t+1)||n.isWalkableAt(e+a,t-1)&&!n.isWalkableAt(e,t-1))return[e,t]}else if(n.isWalkableAt(e+1,t+s)&&!n.isWalkableAt(e+1,t)||n.isWalkableAt(e-1,t+s)&&!n.isWalkableAt(e-1,t))return[e,t];return n.isWalkableAt(e+a,t)||n.isWalkableAt(e,t+s)?this._jump(e+a,t+s,e,t):null};E.prototype._findNeighbors=function(e){var t=e.parent,i=e.x,r=e.y,n=this.grid,a,s,h,u,f=[],p,v,m,b;if(t)a=t.x,s=t.y,h=(i-a)/Math.max(Math.abs(i-a),1),u=(r-s)/Math.max(Math.abs(r-s),1),h!==0&&u!==0?(n.isWalkableAt(i,r+u)&&f.push([i,r+u]),n.isWalkableAt(i+h,r)&&f.push([i+h,r]),(n.isWalkableAt(i,r+u)||n.isWalkableAt(i+h,r))&&f.push([i+h,r+u]),!n.isWalkableAt(i-h,r)&&n.isWalkableAt(i,r+u)&&f.push([i-h,r+u]),!n.isWalkableAt(i,r-u)&&n.isWalkableAt(i+h,r)&&f.push([i+h,r-u])):h===0?n.isWalkableAt(i,r+u)&&(f.push([i,r+u]),n.isWalkableAt(i+1,r)||f.push([i+1,r+u]),n.isWalkableAt(i-1,r)||f.push([i-1,r+u])):n.isWalkableAt(i+h,r)&&(f.push([i+h,r]),n.isWalkableAt(i,r+1)||f.push([i+h,r+1]),n.isWalkableAt(i,r-1)||f.push([i+h,r-1]));else for(p=n.getNeighbors(e,bt.IfAtMostOneObstacle),m=0,b=p.length;m<b;++m)v=p[m],f.push([v.x,v.y]);return f};var At=E,de=R,mt=dt,Mt=pt,kt=vt,wt=At;function Nt(e){return e=e||{},e.diagonalMovement===de.Never?new mt(e):e.diagonalMovement===de.Always?new Mt(e):e.diagonalMovement===de.OnlyWhenNoObstacles?new kt(e):new wt(e)}var Wt=Nt,Pt={Heap:ne,Node:ge,Grid:Xe,Util:J,DiagonalMovement:R,Heuristic:z,AStarFinder:be,BestFirstFinder:it,BreadthFirstFinder:rt,DijkstraFinder:st,BiAStarFinder:Ae,BiBestFirstFinder:at,BiBreadthFirstFinder:ot,BiDijkstraFinder:lt,IDAStarFinder:ht,JumpPointFinder:Wt},Ft=Pt;const Pe=Ee(Ft),yt="/assets/princhess-3b49a5fc.png",Ot="/assets/bishop-odd-72a56f0d.png",Dt="/assets/bishop-0d93e0be.png",Ct="/assets/knight-b1fea073.png",Bt="/assets/rook-f63d7323.png",It="data:image/png;base64,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";var Fe,q,y=48,ye=0;console.log("game start!");ae(document).ready(function(){var e=function(g,A){var k=this.nodes,P,D=g.x,O=g.y,B=[],C=this.piece,j=function(H,X,se){for(var G=D+H,Q=O+X;se.isWalkableAt(G,Q)&&(B.push(k[Q][G]),!P.single);)G+=H,Q+=X};C==="rook"?P=[[0,1],[1,0],[0,-1],[-1,0]]:C==="bishop"?P=[[1,1],[1,-1],[-1,1],[-1,-1]]:C==="knight"?(P=[[2,1],[1,2],[-1,2],[-2,1],[-2,-1],[-1,-2],[1,-2],[2,-1]],P.single=!0):(C==="king"||C==="queen")&&(P=[[1,0],[0,1],[-1,0],[0,-1],[1,1],[1,-1],[-1,-1],[-1,1]],C==="king"&&(P.single=!0));for(var I=0;I<P.length;I++){var S,L;S=P[I][0],L=P[I][1],j(S,L,this)}return B};q=(()=>{const g=[];for(let P=0;P<12;P++){const D=[];for(let O=0;O<12;O++){const B=Math.round(Math.random()*4)<3?0:1;D.push(B)}g.push(D)}g[0][0]=0,g[1][1]=0;const A=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]],k=6;return g.forEach((P,D)=>{P.forEach((O,B)=>{let C=0;for(const j of A){const I=j[0]+B,S=j[1]+D;if(I<0||I>P.length-1||S<0||S>g.length-1){C+=1;continue}C+=g[S][I]}console.log(C),g[D][B]=g[D][B]===1&&C<=k?1:0})}),g})();var i=new Pe.Grid(q),r=new Pe.AStarFinder({heuristic:function(g,A){return .1*(g+A)}});Fe=function(g,A,k,P,D){var O=i.clone();O.piece=D,O.getNeighbors=e;var B=r.findPath(g,A,k,P,O);return B},Fe(1,7,5,6,"knight");var n,a,s,h,u=["rook","knight","bishop"],f=function(){N.load.image("ground",It),N.load.image("enemy-rook",Bt),N.load.image("enemy-knight",Ct),N.load.image("enemy-bishop",Dt),N.load.image("enemy-bishop-odd",Ot),N.load.spritesheet("main-character",yt,24,35)},p=function(){n=N.add.tilemap(),n.tileWidth=y,n.tileHeight=y,n.addTilesetImage("ground");const g=n.create("level1",q[0].length,q.length,y,y);g.resizeWorld();for(var A=0;A<q.length;A++)for(var k=0;k<q[A].length;k++)n.putTile(q[A][k]*2+k%2*(A%2)+(k+1)%2*((A+1)%2),k,A,g);h=N.add.graphics(0,0),a=N.add.group(),W(3,3,"knight"),s=N.add.sprite(0,0,"main-character"),s.currentPosition={x:0,y:0},s.currentMoves=[],s.unfilteredMoves=[],s.width=24,s.height=35,s.anchor.x=-.475,s.anchor.y=-.1825,s.animations.add("idle",[0,1,2,3],5,!0),s.animations.play("idle"),s.inputEnabled=!0,s.input.enableDrag(),s.input.enableSnap(y,y,!1,!0),s.input.useHandCursor=!0,s.events.onDragStop.add(l),l(!0)},v=function(){},m=function(){},b=function(g,A,k){h.beginFill(26112,.5),document.querySelectorAll(".moveTile").forEach(B=>B.remove());for(var P=0;P<g.length;P++){var D=g[P].x,O=g[P].y;h.drawCircle(D*y+y/2,O*y+y/2,y/1.5)}h.endFill()};const F=(g,A)=>{const k=A();return k.piece="queen",k.getNeighbors=e,k.getNeighbors(g,null)},c=(g,A)=>{for(var k=0;k<s[A].length&&!g;k++)g=s[A][k].x==Math.floor(s.x/y)&&s[A][k].y==Math.floor(s.y/y);return g};var l=async function(g){let A=g===!0,k=!1,P=!1,D=!1;if(!A){k=c(k,"currentMoves"),P=c(P,"unfilteredMoves");for(var O=0;O<a.children.length&&!D;O++)D=Math.floor(a.children[O].x/y)==Math.floor(s.x/y)&&Math.floor(a.children[O].y/y)==Math.floor(s.y/y);A=k||P&&D}if(A){h.clear(),s.currentPosition={x:s.x,y:s.y};var B=Math.floor(s.x/y),C=Math.floor(s.y/y),j={x:B,y:C},I=o();I.piece="queen",I.getNeighbors=e;var S=!I.isWalkableAt(B,C);if(S){console.log("you killed an enemy!"),ye++,ae("h1").html(ye);for(var O=0;O<a.children.length;O++){var L=Math.floor(a.children[O].x/y),H=Math.floor(a.children[O].y/y);B==L&&C==H&&(a.children[O].kill(),a.removeChild(a.children[O]))}}await M(),S&&(w(),w()),o().isWalkableAt(B,C)||(console.log("you're dead!"),s.kill(),ae("body").append('<h1><a href="index.html">Game over :( - Play again!</a></h1>')),s.currentMoves=F(j,o),s.unfilteredMoves=F(j,()=>i.clone()),b(s.currentMoves)}else s.x=s.currentPosition.x,s.y=s.currentPosition.y},o=function(){for(var g=i.clone(),A=0;A<a.children.length;A++){var k=Math.floor(a.children[A].x/y),P=Math.floor(a.children[A].y/y);g.setWalkableAt(k,P,!1)}return g},d=()=>new Promise(requestAnimationFrame),M=async function(){for(var g=0;g<a.children.length;g++){var A=Math.floor(a.children[g].x/y),k=Math.floor(a.children[g].y/y),P=o();P.piece=a.children[g].piece,P.getNeighbors=e;var D=r.findPath(A,k,Math.floor(s.x/y),Math.floor(s.y/y),P);const O=10;async function B(C,j,I,S,L){if(L>=1){a.children[g].x=I,a.children[g].y=S;return}const H=Math.sqrt(L),X=I-C,se=S-j,G=C+H*X,Q=j+H*se;return a.children[g].x=G,a.children[g].y=Q,await d(),B(C,j,I,S,L+1/O)}if(D.length>0){const C=a.children[g].x,j=D[1][0]*y,I=a.children[g].y,S=D[1][1]*y;await B(C,I,j,S,0)}}},W=function(g,A,k){a.create(g*y,A*y,"enemy-"+k+(g%2*(A%2)+(g+1)%2*((A+1)%2)==1&&k=="bishop"?"-odd":"")),a.children[a.children.length-1].piece=k,a.children[a.children.length-1].anchor.y=.35,a.children[a.children.length-1].anchor.x=-.15},w=function(){var g=Math.floor(Math.random()*q.length),A=Math.floor(Math.random()*q.length),k=o();k.setWalkableAt(Math.floor(s.x/y),Math.floor(s.y/y),!1),k.isWalkableAt(g,A)?W(g,A,u[Math.floor(Math.random()*u.length)]):w()},N=new Phaser.Game(y*q.length,y*q.length,Phaser.CANVAS,"chess",{preload:f,create:p,update:v,render:m},!1,!1)});
